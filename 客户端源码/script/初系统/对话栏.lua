


--=================,=====================================================--
local 场景类_对话栏 = class()
local 包围盒 = require("gge包围盒")
local tp



function 场景类_对话栏:获取任务事件(任务,编号)
	local 人物组 = {}
	local 事件组 = {}
	if 任务 == "桃园浣熊" then
		if 编号 == 1 then
	  人物组 = {
	  {名称="郭大哥",模型="男人_店小二",X=163,Y=73,方向=1,编号=1},
      {主角=true,X=154,Y=74,方向=7,编号=2},
      {名称="狸",模型="狸",X=158,Y=73,方向=0,编号=3},
      {名称="狸",模型="狸",X=169,Y=70,方向=1,编号=4},
      {名称="狸",模型="狸",X=170,Y=79,方向=2,编号=5},
      }
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:置人物移动(5,3,160,73)]],
      [[引擎.场景.第二场景:置人物移动(5,4,165,72)]],
      [[引擎.场景.第二场景:置人物移动(5,5,165,75)]],
      [[引擎.场景.第二场景:加入喊话(80,3,"你叫破喉咙也没用#28",300)]],
      [[引擎.场景.第二场景:加入喊话(5,1,"救命啊……#14",120)]],
      [[引擎.场景.第二场景:置人物模型(81,3,"狸攻击")]],
      [[引擎.场景.第二场景:置人物方向(82,3,3)]],
      [[引擎.场景.第二场景:置人物模型(150,3,"狸")]],
      [[引擎.场景.第二场景:置人物方向(151,3,3)]],
      [[引擎.场景.第二场景:加入喊话(200,2,"放开那个#G郭大哥\n你们这群#Y老色批#4",500)]],
      [[引擎.场景.第二场景:加进度(220,1)]]},
      [2]={[[引擎.场景.第二场景:删除喊话()]],
      [[引擎.场景.第二场景:加入文本(50,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:郭大哥正在被一群#Y狸猫#新骚扰,我得去帮帮他")]],
      [[引擎.场景.第二场景:加入文本(50,"男人_店小二","#G王大嫂#:救命啊!~我可是#Y黄花大闺男#啊!")]]}
      }
       end
	end
	if 任务 == "枯萎金莲" then
		if 编号 == 1 then
      人物组 = {{名称="王大嫂",模型="女人_王大嫂",X=147,Y=16,方向=1,编号=1},
      {主角=true,X=146,Y=22,方向=6,编号=2}}
      事件组 = {
      [1]={[[引擎.场景.第二场景:加入喊话(5,2,"#G这位大娘\n看你哀声叹气的\n是不是有什么\n事情啊#55",200)]],
      [[引擎.场景.第二场景:加入喊话(80,1,"唉……#14",300)]],
      [[引擎.场景.第二场景:加进度(130,1)]]},
      [2]={[[引擎.场景.第二场景:删除喊话()]],
      [[引擎.场景.第二场景:加入文本(50,"女人_王大嫂","#G王大嫂#:唉……东海湾有不少牲口没了\n官府查了阵子就没了下文。有传言说是妖怪在作祟\n把牲口抓去吃掉了。搞得大家人心惶惶，都不怎么敢去东海湾了。")]],
      [[引擎.场景.第二场景:加入文本(50,"女人_王大嫂","#G王大嫂#:近来不止牲口，连人都有失踪的，城里的#G虎子#不见了好几天了。我们街坊刚提到他。")]],
      [[引擎.场景.第二场景:加入文本(50,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:大娘你有虎子的线索吗？")]],
      [[引擎.场景.第二场景:加入文本(50,"女人_王大嫂","#G王大嫂#:线索……你可以去问问#Y吹牛王#，他跟虎子挺熟的。")]]}
      }
      elseif 编号 == 2 then
	 人物组 = {{名称="吹牛王",模型="男人_苦力",X=88,Y=38,方向=1,编号=1},
	 {主角=true,X=84,Y=39,方向=3,编号=2}}
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:加入文本(5,"男人_苦力","#G吹牛王#:#Y虎子#呀，那家伙喜欢到处乱跑，过几天就会回来吧。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:近来不是很多牲口失踪么，大家都很担心，会不会出什么意外啊？")]],
      [[引擎.场景.第二场景:加入文本(5,"男人_苦力","#G吹牛王#:这个……虎子近来都在帮#Y马全有#干活，你问问他也许有线索。")]]}
      }
      elseif 编号 == 3 then
	 人物组 = {{名称="马全有",模型="男人_武器店老板",X=49,Y=89,方向=1,编号=1},
	 {主角=true,X=45,Y=92,方向=3,编号=2}}
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:加入文本(5,"男人_武器店老板","#G马全有#:#Y虎子#啊，确实好几天没看到他了，我也很担心啊\n他之前是到东海湾抓海龟去了，少侠可以去那边找找他，希望他平安无事吧。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:东海湾这么大，我怎么去找一个不认识的人？")]],
      [[引擎.场景.第二场景:加入文本(5,"男人_武器店老板","#G马全有#:这里有个虎子寄放的包裹，#Y雷黑子#养的狗鼻子挺灵的\n你让他闻一闻这个包裹，他应该就会带你去找虎子了。")]],
      [[引擎.场景.第二场景:加入文本(5,"男人_武器店老板","#G马全有#:有劳少侠了，希望虎子平安无事吧。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:行...包在我身上!")]],
      }
      }
      elseif 编号 == 4 then
	 人物组 = {
	 {名称="雷黑子",模型="小孩_雷黑子",X=70,Y=133,方向=1,编号=1},
	 {名称="旺财",模型="狼",X=75,Y=134,方向=1,编号=3},
	 {主角=true,X=65,Y=133,方向=7,编号=2}}
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:置人物移动(20,3,64,113)]],
      [[引擎.场景.第二场景:置人物移动(40,3,58,121)]],
      [[引擎.场景.第二场景:置人物移动(80,3,204,106)]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:要借#Y旺财#？我的狗狗可不能让你白白带走！你要给我一个、不，两个包子……嗝")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:嗝……吃太多包子了，肚子好饱……算了\n这次#Y旺财#就#G免费#借给你吧，下次还有什么事情找我帮忙，记得带包子给我哦！")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:东海湾这么大，我怎么去找一个不认识的人？")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:谢谢啦，我这就去……啊，这狗怎么#Y一溜烟就跑了#？")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:没关系，准是去了#Y小花姐#那边，你去看看吧。")]],
      }
      }
      elseif 编号 == 5 then
	 人物组 = {
	 {名称="小花",模型="普陀_接引仙女",X=205,Y=107,方向=1,编号=1},
	 {名称="旺财",模型="狼",X=214,Y=102,方向=1,编号=3},
	 {主角=true,X=201,Y=111,方向=7,编号=2}}
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:置人物移动(20,3,231,93)]],
      [[引擎.场景.第二场景:置人物移动(200,3,269,113)]],
      [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G小花#:旺财？就在这边吃东西呢。这孩子就是贪吃。每次一被放走，就跑来我这边讨吃的。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:#35还真是什么样的人养什么样的狗。好啦，吃饱就干活了，这是虎子的包裹，你赶紧嗅一嗅。")]],
      [[引擎.场景.第二场景:加入文本(5,"狼","#G旺财#:(旺财嗅了几下，一溜烟地往东海湾跑去了)")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:看来是有发现了？赶紧跟在后面。")]],
      }
      }
      elseif 编号 == 6 then
	  人物组 = {
	  {名称="云游神医",模型="男人_药店老板",X=85,Y=108,方向=0,编号=1},
	  {主角=true,X=87.3,Y=110.9,方向=2,编号=2},
	  {名称="僵尸虎子",模型="僵尸",X=93,Y=115.5,方向=2,编号=3,不允许加入=true},
	  {名称="迷惘幽灵",模型="幽灵",X=91,Y=118,方向=2,编号=4,不允许加入=true}}
	  事件组 = {
	  [1]={
	  [[引擎.场景.第二场景:加入喊话(5,1,"虎子就在你身后嘛",9999)]],
	  [[引擎.场景.第二场景:加入喊话(20,2,"#117",9999)]],
	  [[引擎.场景.第二场景:置人物方向(30,2,0)]],
	  [[引擎.场景.第二场景:置入人物(98,{3,4},{"无","无"})]],
	  [[引擎.场景.第二场景:加入特效(99,3,"尸腐毒")]],
	  [[引擎.场景.第二场景:加入特效(100,4,"尸腐毒")]],
	  [[引擎.场景.第二场景:加入喊话(150,2,"怎么会这样！",9999)]],
	  [[引擎.场景.第二场景:加进度(160,1)]]},
	  [2]={
	  [[引擎.场景.第二场景:置人物移动(5,3,89,112)]],
	  [[引擎.场景.第二场景:置人物移动(6,4,95,122)]],
	  [[引擎.场景.第二场景:加入文本(100,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:虎子居然变成僵尸了，糟了，他们要扑上来了！")]]}
	  }
	   elseif 编号 == 7 then
	  人物组 = {
	  {名称="楚恋依",模型="普陀_接引仙女",X=58,Y=35,方向=0,编号=1},
	  {主角=true,X=63,Y=34,方向=1,编号=2}}
	  事件组 = {
	  [1]={
	  [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G楚恋依#:此人命不该绝，救他并不困难。不过少侠因此事寻找\n却也是一份机缘。少侠先同我猜个谜底，之后我再救他")]],
	  [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G楚恋依#:我有一物，不生不灭，不垢不净，无忧无怖，无欲无求，是为何物？")]],
	  [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:这个...")]],
	  [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G楚恋依#:替我找一朵金莲花来，你自然知道谜底了。")]],
	  }
	  }
	  elseif 编号 == 8 then
	  人物组 = {
	 {名称="雷黑子",模型="小孩_雷黑子",X=70,Y=133,方向=1,编号=1},
	 {主角=true,X=65,Y=133,方向=7,编号=2},
	 {名称="旺财",模型="狼",X=75,Y=134,方向=1,编号=3}}
	 事件组 = {
	  [1]={
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:嘿嘿，我的旺财是不是只聪明能干的好狗呢？")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:嗯，真是帮了大忙了。对了小弟弟，你知道哪里有金莲花么？")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:我见过红莲花粉莲花白莲花，至于金色莲花么……记得我们上次约好的，现在我肚子饿了，我要吃包子哦。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:……现在的小孩子都是这么馋。(#Y你把虎子发生的事情给雷黑子讲述了#)")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:什么！虎子哥遇到危险了……呜呜，包子我不要了，你赶快把虎子哥救活啊。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:馋嘴归馋嘴，这小孩子还是很热心的。")]],
      [[引擎.场景.第二场景:加入文本(5,"小孩_雷黑子","#G雷黑子#:念佛的小花姐姐供养着一朵金莲花，赶紧去问问她吧。")]],
	  }
	  }
	  elseif 编号 == 9 then
	 人物组 = {
	{名称="小花",模型="普陀_接引仙女",X=205,Y=107,方向=1,编号=1},
	{主角=true,X=201,Y=111,方向=7,编号=2}}
      事件组 = {
      [1]={
      [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G小花#:金莲花？自从我爹娘说什么感情都比不上钱财来得实在,决定把我嫁给马富少，金莲花就逐渐枯萎了……")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:这位姑娘如此单纯美丽，竟也受了世俗的侵扰……千金易求，真心难得，我劝姑娘三思啊……")]],
      [[引擎.场景.第二场景:加入文本(5,"普陀_接引仙女","#G小花#:其实吴生除了家境贫寒什么都好，如果我能够吃在马家睡在吴家该有多好呢……不管怎样，多谢你劝我一番话\n我会仔细想想的。这朵金莲花你要就拿去吧。")]],
      [[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:这……只好这样了……")]],
      }
      }
     elseif 编号 == 10 then
		人物组 = {{名称="观音姐姐",模型="观音姐姐1",X=56,Y=39,方向=0,编号=1},
		{主角=true,模型=tp.队伍[1].模型.."坐下",X=61.5,Y=37,方向=5,编号=2,最后帧方式=2},
		{名称="僵尸虎子",模型="僵尸",X=61.3,Y=42.4,方向=2,编号=3}}
		事件组 = {
		[1]={
		[[引擎.场景.第二场景:加入喊话(30,1,"唵嘛呢叭咪吽！",500)]],
		[[引擎.场景.第二场景:加入特效(70,3,"普渡众生")]],
		[[引擎.场景.第二场景:加入喊话(151,3,"呜哇！！！！！",200)]],
		[[引擎.场景.第二场景:置人物模型(170,3,"赌徒")]],
		[[引擎.场景.第二场景:置人物方向(170,3,2)]],
		[[引擎.场景.第二场景:置人物名称(170,3,"虎子")]],
		[[引擎.场景.第二场景:加入喊话(180,3,"我是谁我在哪里?",200)]],
		[[引擎.场景.第二场景:加进度(200,1)]]},
		[2]={[[引擎.场景.第二场景:删除喊话()]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:此人已无大碍。少侠既已金莲结缘，便请听我一言。")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:此金莲便是如今的‘人性’。五百年前，孙悟空大闹天宫引发三界混战之后\n心魔肆虐，尘世中人性的莲花已经枯萎")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:我佛如来处有三藏真经，可以劝人为善。待要令我送上东土，只怕众生愚言，毁谤真言，故广募与佛有缘之侠者\n遍大义于天下，寻找五个天命取经人。")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:还希望你今后在四大部洲游历的时候能够留心寻找五人，帮他们拂开尘眼，见性归真，甘愿苦历千山，远经万水\n到佛祖处求取真经，劝化众生，化解千年冤戾。")]],
		[[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:金莲重生！你，你原来就是传说中的——神仙！")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:不错，我就是‘落伽山上慈悲主，潮音洞里观世音’")]],
		[[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:你……您……真的是观音吗？")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:观音化生千万，皆为度化众生，是与不是，何须执着。")]],
		[[引擎.场景.第二场景:加入文本(5,tp.队伍[1].模型,"#G"..tp.队伍[1].名称.."#:既然如此，您为何不去度化东海湾的亡魂，而任由他们为祸人间？")]],
		[[引擎.场景.第二场景:加入文本(5,"观音姐姐","#G观音姐姐#:人间种种，必有因果，需有缘之人方可度化。少侠若有意共赴西游之旅\n长安城有不少有学问的人，你可以先找他们了解一下西游的历史。")]],
		}
		}
		end
	end
	return 人物组,事件组
end

function 场景类_对话栏:初始化(根)
	self.ID = 2
	self.x = 127
	self.y = 300
	self.xx = 0
	self.yy = 0
	self.注释 = "对话栏"
	self.可视 = false
	self.鼠标 = false
	self.焦点 = false
	self.可移动 = true
	tp = 根
	local 资源 = tp.资源
	local 按钮 = tp._按钮
	local 自适应 = tp._自适应
	self.资源组 = {
		[1] = 资源:载入('登陆资源.wdf',"网易WDF动画",0x260BE57C),
		[2] = 自适应.创建(28,1,40,28,1,3,nil,18),
		[3] = 按钮.创建(自适应.创建(38,4,74,22,1,3),0,0,4,true,true,"上一页"),
		[4] = 按钮.创建(自适应.创建(38,4,74,22,1,3),0,0,4,true,true,"下一页"),
	}
	self.背景窗口 = 资源:载入('登陆资源.wdf',"网易WDF动画",0x01000050)
	self.头像 = ""
	self.名称 = ""
	self.头像宽度 = 0
	self.头像高度 = 0
	self.文本高度 = 0
	self.选项 = {}
	self.记录文本 = {}
	self.丰富文本 = 根._丰富文本(569,287)
	self.窗口时间 = 0
	self.坐标 = 0
	self.关闭事件 = false
	self.接触按钮 = false
	self.缓冲时间 = 0 -- 都有缓冲时间，避免重复点击
	self.模型头像 = ""
end

function 场景类_对话栏:打开()
	if self.可视 then
		self.丰富文本:清空()
		self.选项 = {}
		self.记录文本 = {}
		self.可视 = false
		self.模型头像 = nil
		self.第二列 = nil
		self.第三列 = nil
		self.第四列 = nil
		self.文本内容 = nil
		tp.场景.事件选中 = false
	else
	    tp.运行时间 = tp.运行时间 + 1
	    self.窗口时间 = tp.运行时间
	    self.可视 = true
	    self.加入 = 0
	end
end

function 场景类_对话栏:显示(dt,x,y)
	if self.缓冲时间 > 0  then
	  	self.缓冲时间 = self.缓冲时间 - 0.2
	end
	self.接触按钮 = false
	if self.头像 ~= "" then
		local v = self.头像宽度
		if v > 50 then
			v = self.x + 13
		end
		self.头像:显示(self.x+15+self.头像.信息组[0][2],self.y-self.头像高度+2,1)
	end
	if self.名称 ~= nil and self.名称 ~= "" then
		self.资源组[1]:显示(self.x,self.y-27)
		tp.字体表.普通字体:置颜色(4294967295):显示(self.x+10 + (78 - #self.名称*3.72),self.y-20,self.名称)
	end
	self.背景窗口:显示(self.x,self.y)
	self.丰富文本:显示(self.x+17,self.y+17)
	self:选项解析(x,y)
	self.焦点 = false
	if self.鼠标 then
		if not self.接触按钮 and not (self.头像 ~= "" and self.头像:是否选中(x,y)) and self.缓冲时间 <= 0 then
			if 引擎.鼠标弹起(0) then
				if #self.记录文本 > 0 then
					self:下一页()
				else
					if self.选项 == nil or (self.选项 ~= nil and self.选项[1] == nil) then
						if self.结束事件 == nil then
							self:打开()
						else
							self:下一页()
							self.结束事件 = nil
						end
					end
					return false
				end
			end
		end
	end

 if 引擎.鼠标弹起(右键) then self:打开() end
end

function 场景类_对话栏:选项解析(x,y)
	if #self.选项 > 20 then
		if self.加入>0 then
			self.资源组[3]:更新1(x,y,self.加入>0)
			self.资源组[3]:显示(self.x+400,self.y+100)
		end
		if self.加入< #self.选项 - 20 then
			self.资源组[4]:更新1(x,y,self.加入< #self.选项 - 20)
			self.资源组[4]:显示(self.x+400,self.y+130)
		end
		if self.资源组[3]:事件判断() and self.资源组[3]:是否选中(x,y) then
			if self.加入 > 0 then
				self.加入 = self.加入 - 10
				if self.加入 < 0 then
					self.加入 = 0
				end
			end
		end
		if self.资源组[4]:事件判断() and self.资源组[4]:是否选中(x,y) then
			if self.加入 < #self.选项 then
				self.加入 = self.加入 + 10
				if self.加入 > #self.选项 - 20 then
					self.加入 = #self.选项 - 20
				end
			end
		end
	end
	if #self.选项 > 0 then
		for n=1, 20 do
			if self.选项[n+self.加入]~=nil then
				local xx = 0
				local yy = 0
				if n<=5 then
					self.选项[n+self.加入].选中判断:置坐标(self.x+19,self.y + self.文本高度+((n-1) * 22) + 5)
				elseif n <= 10 then
					self.选项[n+self.加入].选中判断:置坐标(self.x+self.第二列,self.y + self.文本高度+((n-6) * 22+ 5))
				elseif n <= 15 then
					self.选项[n+self.加入].选中判断:置坐标(self.x+self.第三列,self.y + self.文本高度+((n-11) * 22+ 5))
				elseif n <= 20 then
					self.选项[n+self.加入].选中判断:置坐标(self.x+self.第四列 ,self.y + self.文本高度+((n-16) * 22+ 5))
				end
				if self.鼠标 and self.选项[n+self.加入].选中判断:检查点(x,y) and not self.焦点 then
					self.接触按钮 = true
					self.焦点 = true
					if 引擎.鼠标按住(0) then
						xx = 1
						yy = 1
					end
					if self.选项[n+self.加入].基本内容 then
						self.资源组[2]:置宽高(tp.字体表.普通字体:取宽度(self.选项[n+self.加入].基本内容)+12,28)
						self.资源组[2]:显示(self.选项[n+self.加入].选中判断.x-7+xx,self.选项[n+self.加入].选中判断.y-6+yy)
						if 引擎.鼠标弹起(0) then
							self:事件解析(self.选项[n+self.加入].基本内容,tp.当前地图,self.名称,nil,n)
							if self.关闭事件 then
								self.关闭事件 = false
								break
							end
						end
					end
		        end
		        if  self.选项[n+self.加入]~=nil and  self.选项[n+self.加入].基本内容 == "红尘试炼" then
		        	tp.字体表.普通字体:置颜色(0xFFFFFF00)
		       	elseif self.选项[n+self.加入]~=nil and  (self.选项[n+self.加入].基本内容 == "上交物品"
		       		or self.选项[n+self.加入].基本内容 == "上交召唤兽" or self.选项[n+self.加入].基本内容 == "上交乾坤袋"
		       		or self.选项[n+self.加入].基本内容 == "宠物修炼任务"  or self.选项[n+self.加入].基本内容 == "开启剧情战斗"
		       		or self.选项[n+self.加入].基本内容 == "不和我回去是吧?那只有把你打趴了!" or self.选项[n+self.加入].基本内容 == "随机更换全新宝宝造型(10万仙玉)"
		       		or self.选项[n+self.加入].基本内容 == "商人的鬼魂(日常剧情)" or self.选项[n+self.加入].基本内容 == "查询点卡数量" or self.选项[n+self.加入].基本内容 == "随机更换商城新宝宝造型"
		       		or self.选项[n+self.加入].基本内容 == "妖风(日常剧情)" or self.选项[n+self.加入].基本内容 == "白鹿精(日常剧情)" or self.选项[n+self.加入].基本内容 == "领取比武大赛奖励（全民可领）140级礼包"
		       		or self.选项[n+self.加入].基本内容 == "领取新手礼包" or self.选项[n+self.加入].基本内容 == "酒肉和尚(日常剧情)"
		       		or self.选项[n+self.加入].基本内容 == "蚩尤大战" or self.选项[n+self.加入].基本内容 == "守门天兵(日常剧情)"
		       		or self.选项[n+self.加入].基本内容 == "制作神兵图鉴" or self.选项[n+self.加入].基本内容 == "制作飞行符"
		       		or self.选项[n+self.加入].基本内容 == "制作灵宝图鉴")  then
		        	tp.字体表.普通字体:置颜色(黄色)
		        	--tp.字体表.普通字体:置颜色(-65536)
		        -- elseif self.选项[n+self.加入]~=nil and (self.选项[n+self.加入].基本内容 == "添加无级别灵饰特效(50万仙玉)" or self.选项[n+self.加入].基本内容 == "我要领物理系宝宝（无限领取）"
		        -- 	or self.选项[n+self.加入].基本内容 == "我要领法系宝宝（无限领取）" or self.选项[n+self.加入].基本内容 == "用90级书换100-120级书(消耗1000万经验和银子)"
		        -- 	or self.选项[n+self.加入].基本内容 == "制作灵宝图鉴") then
		        -- 	tp.字体表.普通字体:置颜色(绿色)
		        -- elseif self.选项[n+self.加入]~=nil and self.选项[n+self.加入].基本内容 == "制作飞行符"  then
		        -- 	tp.字体表.普通字体:置颜色(4294919424)
		        else
		        	tp.字体表.普通字体:置颜色(-65536)
		        	--tp.字体表.普通字体:置颜色(-171588352)
		        end
				if self.选项[n+self.加入]~=nil and n<=5 then
					tp.字体表.普通字体:显示(self.x+19 + xx,self.y  + yy + self.文本高度+((n-1) * 22) + 5,self.选项[n+self.加入].基本内容)
				elseif self.选项[n+self.加入]~=nil and n <= 10 then
					tp.字体表.普通字体:显示(self.x+self.第二列 + xx,self.y  + yy + self.文本高度+((n-6) * 22+ 5),self.选项[n+self.加入].基本内容)
				elseif self.选项[n+self.加入]~=nil and n <= 15 then
					tp.字体表.普通字体:显示(self.x+self.第三列 + xx,self.y  + yy + self.文本高度+((n-11) * 22+ 5),self.选项[n+self.加入].基本内容)
				elseif self.选项[n+self.加入]~=nil and n <= 20 then
					tp.字体表.普通字体:显示(self.x+self.第四列 + xx,self.y  + yy + self.文本高度+((n-16) * 22+ 5),self.选项[n+self.加入].基本内容)
				end
			end
		end
	end
end

local 大小排序 = function(a,b)
	return a < b
end

function 场景类_对话栏:文本(头像,名称,内容,选项,附加事件,下一页事件,多重对话)
	if self.可视 and 多重对话==nil then self:打开() end
	if 内容==nil then return  end
	for i=1,#tp.窗口_ do
		if tp.窗口_[i] == self then
			table.remove(tp.窗口_,i)
			break
		end
	end
	table.insert(tp.窗口_,self)
	if not self.可视 then
		self.第二列 = nil
		self.第三列 = nil
		self.第四列 = nil
		self.文本内容 = 内容
		self.附加事件 = 附加事件

		self:打开()
		self.选项 = {}
		self.名称 = 名称
		self.丰富文本:清空()
		self.下一页事件 = 下一页事件


		local ab = self.丰富文本:添加文本(内容)
		if 头像 ~= "" and 头像 ~= nil then
			local 头像资源 = 引擎.取头像(头像)
			self.头像 = tp.资源:载入(头像资源[10] or 头像资源[7],"网易WDF动画",头像资源[4])
			self.头像高度 = self.头像.高度 + tp:取y偏移(头像)
			self.模型头像 = 头像
		else
			self.头像 = ""
			self.模型头像 = ""
		end
		self.文本高度 = ab+23
		if 选项 ~= nil and 选项 ~= "" and type(选项)=="table" and 选项[1] ~= nil then
			local jc = nil
			if #选项 > 5 then
				jc = {}
			end
			for i=1,#选项 do
				if jc ~= nil then
					table.insert(jc,tp.字体表.普通字体:取宽度(选项[i]) or 0)
					if #jc >= 5 then
						table.sort(jc,大小排序)
						if self.第二列 == nil then
							self.第二列 = jc[#jc] + 24 + 35
						elseif self.第三列 == nil then
							self.第三列 = self.第二列 + jc[#jc] + 35
						elseif self.第四列 == nil then
							self.第四列 = self.第三列 + jc[#jc] + 35
						end
						jc = {}
					end
				end
				self.选项[i] = {
					基本内容 = 选项[i],
					选中判断 = 包围盒(0,0,tp.字体表.普通字体:取宽度(选项[i]),14)
				}
			end
		end
		self.缓冲时间 = 2
	else
		local 记录 = {
			头像_ = 头像,
			名称_ = 名称,
			内容_ = 内容,
			选项_ = 选项,
			下一页事件_ = 下一页事件,
		}
		table.insert(self.记录文本,记录)
	end
end

function 场景类_对话栏:下一页()
	--if self.可视 then self:打开() end
	if self.记录文本[1] ~= nil then
		for i=1,#tp.窗口_ do
			if tp.窗口_[i] == self then
				table.remove(tp.窗口_,i)
				break
			end
		end
		table.insert(tp.窗口_,self)
		self.选项 = {}
		self.第二列 = nil
		self.第三列 = nil
		self.第四列 = nil
		local 内容 = self.记录文本[1].内容_
		local 名称 = self.记录文本[1].名称_
		local 头像 = self.记录文本[1].头像_
		local 选项 = self.记录文本[1].选项_
		self.下一页事件 = self.记录文本[1].下一页事件_
		local w = tp.字体表.普通字体:取宽度(内容)
		if w > 438 then
			w = 438
		end
		self.文本内容 = 内容
		self.名称 = 名称
		if self.模型头像 ~= 头像 then
			if 头像 ~= "" and 头像 ~= nil then
				local 头像资源 = 引擎.取头像(头像)
				self.头像 = tp.资源:载入(头像资源[10] or 头像资源[7],"网易WDF动画",头像资源[4])
				self.头像高度 = self.头像.高度 + tp:取y偏移(头像)
				self.模型头像 = 头像
			else
				self.头像 = ""
				self.模型头像 = ""
			end
		end
		self.丰富文本:清空()
		local ab = self.丰富文本:添加文本(内容)
		self.文本高度 = ab+23
		if 选项 ~= nil and 选项 ~= "" and 选项[1] ~= nil then
			local jc = nil
			if #选项 > 5 then
				jc = {}
			end
			for i=1,#选项 do
				if jc ~= nil then
					table.insert(jc,tp.字体表.普通字体:取宽度(选项[i]) or 0)
					if #jc >= 5 then
						table.sort(jc,大小排序)
						if self.第二列 == nil then
							self.第二列 = jc[#jc] + 24 + 35
						elseif self.第三列 == nil then
							self.第三列 = self.第二列 + jc[#jc] + 35
						elseif self.第四列 == nil then
							self.第四列 = self.第三列 + jc[#jc] + 35
						end
						jc = {}
					end
				end
				self.选项[i] = {
					基本内容 = 选项[i],
					选中判断 = 包围盒(0,0,tp.字体表.普通字体:取宽度(选项[i]),14)
				}
			end
		end
		self.缓冲时间 = 3
		table.remove(self.记录文本,1)
	else
		self.可视 = false
	end
end

function 场景类_对话栏:检查点(x,y)
	if self.可视 and (self.背景窗口:是否选中(x,y)  or (self.头像 ~= nil and self.头像 ~= "" and self.头像:是否选中(x,y))) then
		return true
	else
		return false
	end
end

function 场景类_对话栏:初始移动()
	tp.运行时间 = tp.运行时间 + 1
  	self.窗口时间 = tp.运行时间
end

function 场景类_对话栏:开始移动()

end

function 场景类_对话栏:事件解析(事件,地图1,名称,名称1,编号)
	if 事件 == "不了不了" or 事件 == "算了算了" or 事件 == "怕了怕了，我绕着走还不行吗？" or 事件 == "大王，我是来膜拜你绝世的容颜的" or 事件 == "太贵了我没钱" or 事件 == "我随便逛逛 不好意思" or 事件 == "我只是来看看" or 事件 == "我只是看看" or 事件 == "只是路过" or 事件 == "我只是路过" or 事件 == "我只是随便看看" or 事件 == "我还要逛逛" or 事件 == "我点错了" or 事件 == "我什么也不想做" or 事件 == "我保留意见" or 事件 == "我什么都不想做" or 事件 == "没什么，我只是看看" or 事件 == "我们后会有期" then
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "部分解锁" or 事件 == "全面解锁" then
		tp.窗口.物品解锁:打开()
		self.可视 = false
		self.文本栏焦点 = false
		return 0
    elseif 事件 == "确定紅" then
		请求服务(6215,self.附加事件)
		self.附加事件=nil
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "确定藍" then
		请求服务(6216)
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "炼制灵犀之屑" then
		self:文本("物件_打铁炉","物件_打铁炉","炼制灵犀之屑需要，150级-160级的“人物装备”，即可兑换到对应数量的灵犀之屑。\n#G150级装备 = 10\n#G160级装备 = 15",{"我要炼制","我再考虑考虑"})
		return 0
	elseif 事件 == "我要炼制" then
		请求服务(6202)
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "合成灵犀玉" then
		请求服务(6218)
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "更换神器五行" then
		请求服务(6201)
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件 == "帮主" or 事件 == "副帮主" or 事件 == "左护法" or 事件 == "右护法" or 事件 == "长老" or 事件 == "堂主" or 事件 == "帮众" or 事件 == "商人" then
		if tp.窗口.帮派查看.选中 == nil or tp.窗口.帮派查看.帮众数据[tp.窗口.帮派查看.选中5] == nil  then
			tp.常规提示:打开("#Y/请选择正确的目标!")
			return
		end
		名称1=tp.窗口.帮派查看.帮众数据[tp.窗口.帮派查看.选中5].id
		tp.窗口.帮派查看.选中5 = 0
		客户端:请求服务(1502,{事件,地图1,名称,名称1},1)
	-- elseif 事件 == "法系神兽" or 事件 == "物理神兽" then
	-- 	local 物法
	-- 	local 神兽模型 = tp.窗口.商城类.数据[tp.窗口.商城类.分类][tp.窗口.商城类.选中编号3].模型
	-- 	if 神兽模型 == nil then
	-- 		self.可视 = false
	-- 		self.文本栏焦点 = false
	-- 		return 0
	-- 	end
	-- 	if 事件 == "法系神兽" then
	-- 		物法 = "法系"
	-- 	else
	-- 		物法 = nil
	-- 	end
	-- 	local 召唤兽数据 = 宝宝类.创建()
	-- 	local qss = 取神兽资质(神兽模型,物法)
	-- 	召唤兽数据:置新对象(神兽模型,神兽模型,"神兽",属性,0,染色方案,qss[8],qss,qss[7],参战等级,qss[9])
	-- 	tp.窗口.召唤兽查看栏:打开(召唤兽数据)
	-- elseif 事件 == "购买法系神兽" or 事件 == "购买物理神兽" then
	-- 	if 事件 == "购买法系神兽" then
	-- 		物法 = "法系"
	-- 	else
	-- 		物法 = nil
	-- 	end
	-- 	tp.窗口.商城类.仙玉 = tp.窗口.商城类.仙玉 - tp.窗口.商城类.物品数据[tp.窗口.商城类.分类][tp.窗口.商城类.商品编号].价格
	-- 	self.发送信息 = {
	-- 		编号 = tp.窗口.商城类.商品编号,--self.物品数据[self.分类][self.商品编号].编号,
	-- 		位置 = tp.窗口.商城类.商品编号,
	-- 		数量 = tp.窗口.商城类.数量,
	-- 		组号 = tp.窗口.商城类.组号,
	-- 		分类 = tp.窗口.商城类.分类,
	-- 		物法 = 物法
	-- 	}
	-- 	请求服务(30,self.发送信息)
	elseif self.文本内容 == "请选择你要统御的召唤兽。" then
		if tp.窗口.坐骑属性栏.选中 == 0  or not tp.窗口.坐骑属性栏.选中 or tp.坐骑列表[tp.窗口.坐骑属性栏.选中 ] == nil then
			tp.常规提示:打开("#Y/请选择一个坐骑！")
			return
		elseif tp.窗口.坐骑属性栏.可统御信息 == nil or  #tp.窗口.坐骑属性栏.可统御信息 <= 0 then
			tp.常规提示:打开("#Y/你没有可以统御的额召唤兽！")
			return
		else
		    for i=1,#tp.窗口.坐骑属性栏.对话信息 do
		    	if 事件 ~= "算了算了" and 事件 == tp.窗口.坐骑属性栏.对话信息[i] and 编号 == i then
		    		请求服务(90,{序列=tp.窗口.坐骑属性栏.选中,召唤兽编号=i})
		    		break
		    	end
		    end
		end
	elseif 事件=="驯养十次" or 事件=="驯养一次" or 事件=="驯养五十次" then
		local 驯养目标 = tp.窗口.坐骑属性栏.选中
		if 驯养目标==0 or not 驯养目标 or tp.坐骑列表[驯养目标] == nil then
			tp.常规提示:打开("#Y/请选择正确的目标!")
			return
		end
		local 次数 = 1
		if 事件=="驯养十次" then
			次数 = 10
		elseif 事件=="驯养五十次" then
			次数 = 50
		end
		请求服务(92,{编号=驯养目标,次数=次数})
	elseif 事件=="坐骑洗点" then
		local 驯养目标 = tp.窗口.坐骑属性栏.选中
		if 驯养目标==0 or not 驯养目标 or tp.坐骑列表[驯养目标] == nil  then
			tp.常规提示:打开("#Y/请选择正确的目标!")
			return
		end
		请求服务(94,{编号=驯养目标})
	elseif 事件=="坐骑放生" then
		local 驯养目标 = tp.窗口.坐骑属性栏.选中
		if 驯养目标==0 or not 驯养目标 or tp.坐骑列表[驯养目标] == nil  then
			tp.常规提示:打开("#Y/请选择正确的目标!")
			return
		end
		请求服务(95,{编号=驯养目标})
	elseif 事件=="确认" then
		-- 处理背包扩展确认
		请求服务(3758,{类型="扩展背包"})
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	elseif 事件=="取消" then
		-- 处理背包扩展取消
		self.可视 = false
		self.文本栏焦点 = false
		return 0
	-- elseif 事件=="坐骑喂养" then
	-- 	local 驯养目标 = tp.窗口.坐骑属性栏.选中
	-- 	if 驯养目标==0 or not 驯养目标 or tp.坐骑列表[驯养目标] == nil  then
	-- 		tp.常规提示:打开("#Y/请选择正确的目标!")
	-- 		return
	-- 	end
	-- 	请求服务(97,{编号=驯养目标})	-- elseif 事件 == "什么是化境" then
	else
		客户端:请求服务(1502,{事件,地图1,名称,名称1},1)
	end
	self.可视 = false
	self.文本栏焦点 = false
end

return 场景类_对话栏